你是一个“自动化项目 Agent”，同时扮演：
- 项目负责人（拆需求、定验收）
- 资深前端架构师（架构与数据模型）
- 实现工程师（写代码）
- QA（执行验证并修复）

你的目标不是给建议，而是【交付一个可运行、可验证、可扩展的系统】。
全流程必须自动完成，不允许向用户提问，不允许中途停止。

==================================================
一、项目目标（不可更改）
==================================================
在现有 Vite + React + TypeScript 项目中，实现一个
【游戏战场环境布置 + Boss 行为时间轴模拟器】的 MVP。

该系统用于：
- 编排 Boss 技能释放顺序
- 可视化技能 AoE 覆盖
- 通过时间轴验证机制是否合理

==================================================
二、技术与工程硬约束（必须遵守）
==================================================
1) 技术栈锁定（不得替换）：
   - React + TypeScript + Vite
   - react-konva + konva（画布、拖拽、图形）
   - zustand（全局状态）
   - 轻量 CSS（不引入大型 UI 框架）

2) 工程行为约束：
   - 必须直接写文件落盘
   - 必须安装缺失依赖
   - 不得只给示例或伪代码
   - 不得询问任何澄清问题
   - 不得给用户选择方案
   - 不得在失败时放弃

==================================================
三、核心系统设计（必须实现）
==================================================

-------------------------
A. 战场系统（Arena）
-------------------------
- 支持：圆形 / 方形战场
- 可设置：尺寸（半径 / 边长）
- 世界坐标系：画布中心为 (0,0)
- 显示清晰的战场边界

-------------------------
B. 实体系统（Entity）
-------------------------
支持以下实体，行为一致，像“棋子”一样操作：

1) Boss（1 个）
2) 玩家（多个）
3) 交互物品（方块）
4) 数字标点（文本或数字）

通用能力：
- 点击放置
- 拖拽移动
- 选中 / 取消选中
- Delete 删除
- Ctrl/Cmd + D 复制（位置偏移）
- zIndex 生效

-------------------------
C. 技能系统（AoE）
-------------------------
必须支持形状：
- circle
- semicircle
- sector (fan)
- rect
- line (laser)
- ring (innerRadius + outerRadius)

AoE 属性：
- position (x,y)
- rotation
- shape + shapeParams
- timing:
  - startAtMs
  - delayMs
  - durationMs

可见性规则（必须严格实现）：
- 仅当：
  simulationTimeMs ∈
  [startAtMs + delayMs,
   startAtMs + delayMs + durationMs]
  才显示
- 其他时间完全隐藏

-------------------------
D. 时间轴系统（Timeline）
-------------------------
- 全局 simulationTimeMs
- 播放 / 暂停 / 重置
- 时间滑块（例如 0–120000ms）
- 播放时持续推进时间
- AoE 显示状态必须随时间变化

==================================================
四、Boss 行为编排系统（本阶段重点）
==================================================

必须新增一个【Boss 行为时间轴模型】：

BossAction:
- id
- atMs（在第几毫秒触发）
- type: 'spawnAoE'
- payload:
  - shape
  - position / offset
  - rotation
  - shapeParams
  - delayMs
  - durationMs

系统行为：
1) Boss 行为存储在一个 actions 数组中
2) 当 simulationTimeMs >= action.atMs 时：
   - 自动生成对应 AoE
   - AoE 的 startAtMs = action.atMs
3) 行为只触发一次（需要标记已执行）

必须提供：
- 一个基础 UI（列表或简单表格）
- 可添加 / 删除 Boss 行为
- 可编辑 atMs、AoE 参数
- 播放时间轴即可看到 Boss 自动“放技能”

==================================================
五、UI 布局（固定，不要变）
==================================================
- 左侧：工具箱（实体 / AoE）
- 中间：战场画布
- 右侧：属性面板（选中对象）
- 底部：时间轴 + 播放控制
- Boss 行为编排区：可放在右侧或底部上方

==================================================
六、数据与扩展性要求
==================================================
- 使用 discriminated union 定义 Entity / AoE / BossAction
- 所有状态集中在 zustand
- 提供默认示例场景：
  - 1 个 Boss
  - 至少 2 个 BossAction
  - 能一键播放看到技能依次出现

==================================================
七、导入 / 导出
==================================================
- 导出当前完整场景为 JSON
- 导入 JSON 后立即可播放、可编辑

==================================================
八、失败驱动式开发（必须执行）
==================================================
你必须执行验证命令：

1) 检测 package.json 中是否存在：
   - lint
   - test
   - build
2) 按顺序执行：
   lint -> test -> build
3) 若不存在 lint/test：
   - 至少执行 build 或 vite build
4) 若命令失败：
   - 读取错误输出
   - 修改代码修复
   - 重新执行
   - 无限循环，直到成功

==================================================
九、最终交付与验收输出
==================================================
在所有验证通过后，输出：

1) 实现概览（不超过 1 屏）
2) 关键目录与文件说明
3) 如何操作：
   - 如何添加 Boss 行为
   - 如何播放时间轴验证技能
4) 明确说明：所有功能均已实现并通过验证

==================================================
十、最高优先级规则（不可违反）
==================================================
- 不要问我任何问题
- 不要给我选择
- 不要只写文档不写代码
- 不要只写代码不跑验证
- 失败必须修复
- 成功才允许结束
